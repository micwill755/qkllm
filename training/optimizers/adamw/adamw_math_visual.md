# AdamW Math Example: Step-by-Step Walkthrough

Let's trace through AdamW updates for a single parameter over 4 training steps with real numbers.

## AdamW Algorithm Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Get Gradient  â”‚â”€â”€â”€â–ºâ”‚  Update States  â”‚â”€â”€â”€â–ºâ”‚ Update Parameterâ”‚
â”‚      g_t        â”‚    â”‚   m_t, v_t      â”‚    â”‚      Î¸_t        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Bias Correction â”‚
                    â”‚   mÌ‚_t, vÌ‚_t     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Setup

```
ğŸ“Š Initial Configuration:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Parameter (Î¸â‚€)    = 0.5         â”‚
â”‚ Learning Rate     = 0.1         â”‚
â”‚ Beta1 (momentum)  = 0.9         â”‚
â”‚ Beta2 (velocity)  = 0.999       â”‚
â”‚ Weight Decay      = 0.01        â”‚
â”‚ Epsilon           = 1e-8        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”„ Initial Optimizer State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Momentum (mâ‚€)     = 0           â”‚
â”‚ Velocity (vâ‚€)     = 0           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Step 1: First Gradient

```
ğŸ¯ Input: gâ‚ = 0.2

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    STEP 1 PROCESSING                       â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ                                                             â”ƒ
â”ƒ  1ï¸âƒ£ Update Momentum:                                        â”ƒ
â”ƒ     mâ‚ = 0.9 Ã— 0 + 0.1 Ã— 0.2 = 0.02                       â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  2ï¸âƒ£ Update Velocity:                                        â”ƒ
â”ƒ     vâ‚ = 0.999 Ã— 0 + 0.001 Ã— (0.2)Â² = 0.00004             â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  3ï¸âƒ£ Bias Correction:                                        â”ƒ
â”ƒ     mÌ‚â‚ = 0.02 / (1-0.9Â¹) = 0.02/0.1 = 0.2                 â”ƒ
â”ƒ     vÌ‚â‚ = 0.00004 / (1-0.999Â¹) = 0.00004/0.001 = 0.04      â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  4ï¸âƒ£ Weight Decay:                                           â”ƒ
â”ƒ     Î¸ = 0.5 - 0.01Ã—0.5 = 0.495                             â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  5ï¸âƒ£ Parameter Update:                                       â”ƒ
â”ƒ     Î¸â‚ = 0.495 - 0.1Ã—0.2/âˆš0.04 = 0.495 - 0.1 = 0.395      â”ƒ
â”ƒ                                                             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

ğŸ“Š Result: Î¸â‚ = 0.395, mâ‚ = 0.02, vâ‚ = 0.00004
```

## Step 2: Second Gradient

```
ğŸ¯ Input: gâ‚‚ = 0.15

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    STEP 2 PROCESSING                       â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ                                                             â”ƒ
â”ƒ  1ï¸âƒ£ Update Momentum:                                        â”ƒ
â”ƒ     mâ‚‚ = 0.9Ã—0.02 + 0.1Ã—0.15 = 0.018 + 0.015 = 0.033      â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  2ï¸âƒ£ Update Velocity:                                        â”ƒ
â”ƒ     vâ‚‚ = 0.999Ã—0.00004 + 0.001Ã—(0.15)Â² = 0.00006246       â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  3ï¸âƒ£ Bias Correction:                                        â”ƒ
â”ƒ     mÌ‚â‚‚ = 0.033 / (1-0.9Â²) = 0.033/0.19 = 0.174            â”ƒ
â”ƒ     vÌ‚â‚‚ = 0.00006246 / (1-0.999Â²) = 0.0312                  â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  4ï¸âƒ£ Weight Decay:                                           â”ƒ
â”ƒ     Î¸ = 0.395 - 0.01Ã—0.395 = 0.39105                       â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  5ï¸âƒ£ Parameter Update:                                       â”ƒ
â”ƒ     Î¸â‚‚ = 0.39105 - 0.1Ã—0.174/âˆš0.0312 = 0.293               â”ƒ
â”ƒ                                                             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

ğŸ“Š Result: Î¸â‚‚ = 0.293, mâ‚‚ = 0.033, vâ‚‚ = 0.00006246
```

## Step 3: Third Gradient

```
ğŸ¯ Input: gâ‚ƒ = 0.25 (â¬†ï¸ LARGER gradient)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    STEP 3 PROCESSING                       â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ                                                             â”ƒ
â”ƒ  1ï¸âƒ£ Update Momentum:                                        â”ƒ
â”ƒ     mâ‚ƒ = 0.9Ã—0.033 + 0.1Ã—0.25 = 0.0297 + 0.025 = 0.0547   â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  2ï¸âƒ£ Update Velocity:                                        â”ƒ
â”ƒ     vâ‚ƒ = 0.999Ã—0.00006246 + 0.001Ã—(0.25)Â² = 0.0001249     â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  3ï¸âƒ£ Bias Correction:                                        â”ƒ
â”ƒ     mÌ‚â‚ƒ = 0.0547 / (1-0.9Â³) = 0.0547/0.271 = 0.202         â”ƒ
â”ƒ     vÌ‚â‚ƒ = 0.0001249 / (1-0.999Â³) = 0.0416                   â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  4ï¸âƒ£ Weight Decay:                                           â”ƒ
â”ƒ     Î¸ = 0.293 - 0.01Ã—0.293 = 0.29007                       â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  5ï¸âƒ£ Parameter Update:                                       â”ƒ
â”ƒ     Î¸â‚ƒ = 0.29007 - 0.1Ã—0.202/âˆš0.0416 = 0.191               â”ƒ
â”ƒ                                                             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

ğŸ“Š Result: Î¸â‚ƒ = 0.191, mâ‚ƒ = 0.0547, vâ‚ƒ = 0.0001249
```

## Step 4: Fourth Gradient

```
ğŸ¯ Input: gâ‚„ = 0.05 (â¬‡ï¸ SMALLER gradient)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    STEP 4 PROCESSING                       â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ                                                             â”ƒ
â”ƒ  1ï¸âƒ£ Update Momentum:                                        â”ƒ
â”ƒ     mâ‚„ = 0.9Ã—0.0547 + 0.1Ã—0.05 = 0.04923 + 0.005 = 0.05423â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  2ï¸âƒ£ Update Velocity:                                        â”ƒ
â”ƒ     vâ‚„ = 0.999Ã—0.0001249 + 0.001Ã—(0.05)Â² = 0.0001272      â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  3ï¸âƒ£ Bias Correction:                                        â”ƒ
â”ƒ     mÌ‚â‚„ = 0.05423 / (1-0.9â´) = 0.05423/0.3439 = 0.158      â”ƒ
â”ƒ     vÌ‚â‚„ = 0.0001272 / (1-0.999â´) = 0.0318                   â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  4ï¸âƒ£ Weight Decay:                                           â”ƒ
â”ƒ     Î¸ = 0.191 - 0.01Ã—0.191 = 0.18909                       â”ƒ
â”ƒ                                                             â”ƒ
â”ƒ  5ï¸âƒ£ Parameter Update:                                       â”ƒ
â”ƒ     Î¸â‚„ = 0.18909 - 0.1Ã—0.158/âˆš0.0318 = 0.100               â”ƒ
â”ƒ                                                             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

ğŸ‰ Final Result: Î¸â‚„ = 0.100
```

## Visual Summary

### Parameter Evolution
```
Î¸ (Parameter Value)
â”‚
0.5 â”¤â—
    â”‚ \
0.4 â”¤  â—
    â”‚   \
0.3 â”¤    â—
    â”‚     \
0.2 â”¤      â—
    â”‚       \
0.1 â”¤        â—
    â”‚
0.0 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    0   1   2   3   4
        Training Steps

ğŸ¯ Journey: 0.5 â†’ 0.395 â†’ 0.293 â†’ 0.191 â†’ 0.100
```

### Key Observations

#### 1ï¸âƒ£ Momentum Builds Up
```
ğŸ“ˆ Corrected Momentum (mÌ‚_t):
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Step â”‚  Value  â”‚         Behavior             â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1  â”‚  0.200  â”‚ ğŸš€ Just current gradient     â”‚
â”‚  2  â”‚  0.174  â”‚ ğŸ”„ Smoothed with previous    â”‚
â”‚  3  â”‚  0.202  â”‚ â¬†ï¸ Builds momentum           â”‚
â”‚  4  â”‚  0.158  â”‚ â¬‡ï¸ Dampens (direction change)â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2ï¸âƒ£ Adaptive Learning Rate
```
ğŸ›ï¸ Effective Learning Rates:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gradient   â”‚   Step   â”‚ Effective LRâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Large (0.25)â”‚    3     â”‚    0.099    â”‚
â”‚ Small (0.05)â”‚    4     â”‚    0.089    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ Similar update sizes despite different gradients!
```

#### 3ï¸âƒ£ Bias Correction Impact
```
ğŸ”§ Bias Correction Boost:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Step â”‚   Raw   â”‚ Corrected â”‚  Boost  â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1  â”‚  0.020  â”‚   0.200   â”‚   10x   â”‚
â”‚  4  â”‚  0.054  â”‚   0.158   â”‚   3x    â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š Early steps get bigger correction!
```

#### 4ï¸âƒ£ Weight Decay Effect
```
ğŸ¯ Regularization:
Each step: Î¸ = Î¸ Ã— 0.99

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gradually shrinks parameters   â”‚
â”‚  toward zero for regularization â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Summary

```
ğŸ‰ AdamW Journey: 0.5 â†’ 0.100 (4 steps)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HOW ADAMW WORKS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ”„ Smoothing Gradients                                     â”‚
â”‚     â””â”€ Momentum builds up consistent directions             â”‚
â”‚                                                             â”‚
â”‚  ğŸ›ï¸ Adapting Learning Rate                                  â”‚
â”‚     â””â”€ Each parameter gets personalized updates             â”‚
â”‚                                                             â”‚
â”‚  ğŸ”§ Correcting Early Bias                                   â”‚
â”‚     â””â”€ Boosts estimates when optimizer is "cold"           â”‚
â”‚                                                             â”‚
â”‚  ğŸ¯ Applying Regularization                                 â”‚
â”‚     â””â”€ Weight decay prevents overfitting                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ Result: Stable, adaptive updates that work across
    different parameter scales - perfect for LLMs!
```